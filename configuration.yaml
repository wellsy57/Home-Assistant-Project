#
#Start Builtin Config
#########################################
homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: -27.7192977
  longitude: 153.1924409
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: 17
  # metric for Metric, imperial for Imperial
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: Australia/Brisbane
  # Customization file
  customize: !include customize.yaml

# Configure a default setup of Home Assistant (frontend, api, etc)
default_config:

# Show the introduction message on startup.
# introduction:

# Uncomment this if you are using SSL/TLS, running in Docker container, etc.
# http:
#   base_url: example.duckdns.org:8123

lovelace:
  mode: yaml

#########################################
#End Builtin Config
#
#Start Nest
#########################################
# Nest login
nest:
  client_id: eba11a2c-0fab-4555-a5e6-9bea3104ae87
  client_secret: BQXWd7NkXzbb06wQepWpSVRkl
#########################################
#End Nest
#
#Start Sensors
#########################################
#
# Weather prediction
#
sensor:
  - platform: bom
    station: IDQ60901.95581
    name: Beenleigh
    monitored_conditions:
      - air_temp
      - rel_hum
      - weather
      - wind_dir
      - wind_spd_kmh
#########################################      
#
#
#START Modbus sensors
#
#
  - platform: modbus
    scan_interval: 10
    registers:
#########################################
#START Modbus hub5 sensors
#    
      - name: RTC YEAR
        hub: hub5
        slave: 5
        register: 3328
      - name: RTC MONTH
        hub: hub5
        slave: 5
        register: 3329
      - name: RTC DAY
        hub: hub5
        slave: 5
        register: 3330
      - name: RTC HOUR
        hub: hub5
        slave: 5
        register: 3331
      - name: RTC MINUTE
        hub: hub5
        slave: 5
        register: 3332
      - name: RTC SECOND
        hub: hub5
        slave: 5
        register: 3333          
      - name: HOT WATER Inst
        hub: hub5
        unit_of_measurement: °C
        slave: 5
        register: 3124  
      - name: HOT WATER Avg
        hub: hub5
        unit_of_measurement: °C
        slave: 5
        register: 3125
      - name: HOT WATER Cal SP
        hub: hub5
        unit_of_measurement: SP
        slave: 5
        register: 3123        
      - name: Laundry Path Lights TMR Elapsed
        hub: hub5
        unit_of_measurement: secs
        slave: 5
        register: 3122
      - name: Back Door Occupied TMR Elap
        hub: hub5
        unit_of_measurement: secs
        slave: 5
        register: 3121 
      - name: Front Occupied TMR Elapsed
        hub: hub5
        unit_of_measurement: secs
        slave: 5
        register: 3120 
      - name: Front Occupied TMR SP
        hub: hub5
        unit_of_measurement: secs
        slave: 5
        register: 3119
      - name: RumpusWet Cal SP
        hub: hub5
        unit_of_measurement: SP
        slave: 5
        register: 3112
      - name: Lounge
        hub: hub5
        unit_of_measurement: °C
        slave: 5
        register: 3101 
      - name: 12VDC
        hub: hub5
        unit_of_measurement: V
        slave: 5
        register: 3093           
      - name: 24VDC
        hub: hub5
        unit_of_measurement: V
        slave: 5
        register: 3090
      - name: 240 V
        hub: hub5
        unit_of_measurement: V
        slave: 5
        register: 3087
      - name: Power Rumpus Cumulative
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3078      
      - name: Power Unknown Cumulative
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3077
      - name: Power Solar Cumulative
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3076 
      - name: Power House Cumulative
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3075
      - name: Power Rumpus Cumulative
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3078  
      - name: Power ACs Cumulative 3167
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3167 
      - name: Power ACs 24HR 3166
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3166
#######################################                                                                                              
      - name: Power HW 3163
        hub: hub5
        unit_of_measurement: W
        slave: 5
        register: 3163

#######################################        
#######################################        
      - name: Power Solar
        hub: hub5
        unit_of_measurement: W
        slave: 5
        register: 3160

#######################################    
            
      - name: Power ACs 3157
        hub: hub5
        unit_of_measurement: W
        slave: 5
        register: 3157

#######################################        
        
#######################################        
      - name: Power Rumpus 3155
        hub: hub5
        unit_of_measurement: W
        slave: 5
        register: 3155

#######################################              
      - name: Power Cumulative Total 3154
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3154
      - name: Power All Load 24HR
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3153 
      - name: Power Solar Cumulative Total 3131
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3131  
      - name: Power HW Cumulative Total 3130
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3130
      - name: Power Rumpus Cumulative Total 3134
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3134 
      - name: Power Rumpus 24HR Total 3133
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3133  
      - name: Power Solar 24HR
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3129
      - name: Power HW 24HR Total 3127
        hub: hub5
        unit_of_measurement: kWh
        slave: 5
        register: 3127         
      - name: Outside
        hub: hub5
        unit_of_measurement: °C
        slave: 5
        register: 3099
      - name: Rumpus
        hub: hub5
        unit_of_measurement: °C
        slave: 5
        register: 3100
#######################################              
      - name: Combined Load Power
        hub: hub5
        unit_of_measurement: W
        slave: 5
        register: 3081
####################################### 
              
      - name: Solar Combined Load Power Difference
        hub: hub5
        unit_of_measurement: W
        slave: 5
        register: 3082
#
#########################################
#END Modbus hub5 sensors
#                
####################################### 
#
#START modbus hub3 sensors
#      
#########################################        
#
      - name: Master YEAR
        hub: hub3
        slave: 3
        register: 3328
      - name: Master MONTH
        hub: hub3
        slave: 3
        register: 3329
      - name: Master DAY
        hub: hub3
        slave: 3
        register: 3330
      - name: Master HOUR
        hub: hub3
        slave: 3
        register: 3331
      - name: Master MINUTE
        hub: hub3
        slave: 3
        register: 3332
      - name: Master SECOND
        hub: hub3
        slave: 3
        register: 3333      
      - name: Rainwater Litres
        hub: hub3
        unit_of_measurement: "L"
        slave: 3
        register: 3093
      - name: Rainwater Percent
        hub: hub3
        slave: 3
        register: 3097
        unit_of_measurement: "%"
      - name: Rain Last Hour
        hub: hub3
        unit_of_measurement: "mm"
        slave: 3
        register: 3088
      - name: Rain 24 Hours
        hub: hub3
        unit_of_measurement: "mm"
        slave: 3
        register: 3089
      - name: Rain Total
        hub: hub3
        unit_of_measurement: "mm"
        slave: 3
        register: 3090
      - name: Irrigation Shadehouse Setpoint
        hub: hub3
        unit_of_measurement: "mins"
        slave: 3
        register: 3079
      - name: Irrigation Pool Setpoint
        hub: hub3
        unit_of_measurement: "mins"
        slave: 3
        register: 3080
      - name: Irrigation notusedatm Setpoint
        hub: hub3
        unit_of_measurement: "mins"
        slave: 3
        register: 3081        
      - name: Irrigation Shadehouse Elap
        hub: hub3
        unit_of_measurement: "mins"
        slave: 3
        register: 3098
      - name: Irrigation Pool Elap
        hub: hub3
        unit_of_measurement: "mins"
        slave: 3
        register: 3099
      - name: Irrigation notusedatm Elap
        hub: hub3
        unit_of_measurement: "mins"
        slave: 3
        register: 3100  
      - name: Irrigation Start Time
        hub: hub3
        unit_of_measurement: "00"
        slave: 3
        register: 3074
      - name: Charger Start Time
        hub: hub3
        unit_of_measurement: "00"
        slave: 3
        register: 3121
      - name: Charger Stop Time
        hub: hub3
        unit_of_measurement: "00"
        slave: 3
        register: 3123  
      - name: Grey Water Run Setpoint
        hub: hub3
        slave: 3
        register: 3084                      

#
#########################################
#END Modbus hub3 sensors
#                
####################################### 
#
#START modbus hub1 sensors
#      
#########################################        
#       
      - name: Treated Water Litres
        hub: hub1
        unit_of_measurement: "L"
        slave: 1
        register: 3078
      - name: Fertilzer Litres
        hub: hub1
        unit_of_measurement: "L"
        slave: 1
        register: 3079 
      - name: Pond Temperature
        hub: hub1
        unit_of_measurement: "°C"
        slave: 1
        register: 3101  
      - name: Grey Water RUN COUNT
        hub: hub1 
        #unit_of_measurement: "L"
        slave: 1
        register: 3082
      - name: Grey Water RUN COUNT Batch
        hub: hub1
        #unit_of_measurement: "L"
        slave: 1
        register: 3081 
      - name: NonBatch Timer
        hub: hub1
        unit_of_measurement: "mins"
        slave: 1
        register: 3075  
      - name: Batch Timer
        hub: hub1
        unit_of_measurement: "mins"
        slave: 1
        register: 3083 
      - name: Batch Timer SP
        hub: hub1
        unit_of_measurement: "mins"
        slave: 1
        register: 3080     
      - name: Sludge Pump Restart Delay
        hub: hub1
        unit_of_measurement: "seconds" 
        slave: 1
        register: 3092                                                                          
#
#########################################
#END Modbus hub1 sensors
#  
#######################################       
# END Modbus sensors
              
##########################################

  - platform: statistics
    entity_id: sensor.master_bedroom_temperature
    name: master temp
    precision: 0

  - platform: statistics
    entity_id: sensor.outside_mqtt_temperature
    name: outside temp
    precision: 0

  - platform: statistics
    entity_id: sensor.lounge
    name: lounge temp
    precision: 0

  - platform: statistics
    entity_id: sensor.power_solar
    name: solar power
    precision: 0

  - platform: statistics
    entity_id: sensor.power_acs_3157
    name: aircon power
    precision: 0

  - platform: statistics
    entity_id: sensor.power_rumpus_3155
    name: rumpus power
    precision: 0

  - platform: statistics
    entity_id: sensor.combined_load_power
    name: combined load power
    precision: 0

  - platform: statistics
    entity_id: sensor.power_hw_3163
    name: house garage power
    precision: 0

##########################################
#mqtt sensors
  - platform: mqtt
    state_topic: "tele/sonoff17/SENSOR"
    name: "Rumpus Temperature"
    unit_of_measurement: "°C" 
    value_template: "{{ value_json.DHT11.Temperature }}"

  - platform: statistics
    entity_id: sensor.rumpus_temperature
    name: rumpus temp
    precision: 0

  - platform: mqtt
    state_topic: "tele/sonoff17/SENSOR"
    name: "Rumpus Humidity"
    unit_of_measurement: "RH%" 
    value_template: "{{ value_json.DHT11.Humidity }}"    

  - platform: mqtt
    state_topic: "tele/sonoff18/SENSOR"
    name: "Shadehouse Temperature"
    unit_of_measurement: "°C" 
    value_template: "{{ value_json.DHT11.Temperature }}"
  - platform: mqtt
    state_topic: "tele/sonoff18/SENSOR"
    name: "Shadehouse Humidity"
    unit_of_measurement: "RH%" 
    value_template: "{{ value_json.DHT11.Humidity }}"

  - platform: mqtt
    state_topic: "tele/sonoff22/SENSOR"
    name: "Master Bedroom Temperature"
    unit_of_measurement: "°C" 
    value_template: "{{ value_json.DHT11.Temperature }}"
  - platform: mqtt
    state_topic: "tele/sonoff22/SENSOR"
    name: "Master Bedroom Humidity"
    unit_of_measurement: "RH%" 
    value_template: "{{ value_json.DHT11.Humidity }}" 

  - platform: mqtt
    state_topic: "tele/sonoff24/SENSOR"
    name: "Outside MQTT Temperature"
    unit_of_measurement: "°C" 
    value_template: "{{ value_json.DHT11.Temperature }}"
  - platform: mqtt
    state_topic: "tele/sonoff24/SENSOR"
    name: "Outside MQTT Humidity"
    unit_of_measurement: "RH%" 
    value_template: "{{ value_json.DHT11.Humidity }}"

  - platform: template
    sensors:
      outside_temp_calibrated:
        unit_of_measurement: "°C"
        value_template: '{{ (states.sensor.outside_mqtt_temperature.state | float - 1) }}'           

##########################################
# MQTT Ultrasonic Sensors

  - platform: mqtt
    name: "Pool Level"
    state_topic: "tele/sonoff23/SENSOR"
    value_template: "{{ value_json.SR04.Distance }}"
    unit_of_measurement: "cm"

  - platform: mqtt
    name: "Tank Level"
    state_topic: "tele/esp01/SENSOR"
    value_template: "{{ value_json.SR04.Distance }}"
    unit_of_measurement: "cm"

#  - platform: mqtt
#    name: "Tank Level 2"
#    state_topic: "tele/sonoff20/SENSOR"
#    value_template: "{{ value_json.SR04.Distance }}"
#    unit_of_measurement: "cm"

##########################################
# END MQTT Ultrasonic Sensor    
##########################################
#
#Start Template sensors
#
# Ultrasonic Template Sensors
#

  - platform: template
    sensors:
      pool_level_inverted:
        unit_of_measurement: "cm"
        value_template: '{{ (states.sensor.pool_level.state | float * -1 + 200) | round(0) }}' 

  - platform: template
    sensors:
      tank_level_inverted:
        unit_of_measurement: "cm"
        value_template: '{{ (states.sensor.tank_level.state | float * -1 + 235) | round(0) }}'

#  - platform: template
#    sensors:
#      tank_level_2_inverted:
#        unit_of_measurement: "cm"
#        value_template: '{{ (states.sensor.tank_level_2.state | float * -1 + 235) | round(0) }}'        

# Ultrasonic Template Sensor %
#

  - platform: template
    sensors:
      pool_level_storage:
        unit_of_measurement: "%"
        value_template: "{{ (200 - states('sensor.pool_level') | float * 10) | round(0) }}"   

  - platform: template
    sensors:
      tank_level_storage:
        unit_of_measurement: "%"
        value_template: "{{ (111.86 - states('sensor.tank_level') | float * 0.476) | round(0) }}"  
        
#  - platform: template
#    sensors:
#      tank_level_2_storage:
#        unit_of_measurement: "%"
#        value_template: "{{ (111.86 - states('sensor.tank_level_2') | float * 0.476) | round(0) }}"        

#
# END Ultrasonic Template Sensor
#


  - platform: statistics
    entity_id: sensor.pool_level_inverted
    name: pool_level.stats
    precision: 1


  - platform: template
    sensors:
      pool_level_litres:
        unit_of_measurement: "L"
        value_template: '{{ (states.sensor.pool_level.state | float * -1 + 200 * 275) | round(0) }}'

  - platform: statistics
    entity_id: sensor.tank_level_storage
    name: tank_storage.stats
    precision: 1 
    
#  - platform: statistics
#    entity_id: sensor.tank_level_2_storage
#    name: tank_storage_2.stats
#    precision: 1    
    
    
#
# END Ultrasonic Template Sensor
#      

#########################################


# END Template sensors - ie: calibrated
 
##########################################
#End Sensors
#                              
#

#Start MQTT
#########################################
#START MQTT BROKER
mqtt:
  broker: 192.168.1.55
  port: 1883
  username: WTF
  password: thissucks
  protocol: 3.1
  birth_message:
    topic: "tele/hassio/LWT"
    payload: "Online"
    qos: 1
    retain: true
  will_message:
    topic: "tele/hassio/LWT"
    payload: "Offline"
    qos: 1
    retain: true

#########################################
#End MQTT Broker
#                              
#
#Start MQTT Discovery
#########################################
#
  discovery: true
  discovery_prefix: homeassistant
#########################################
#End MQTT Discovery
#END MQTT
#
#Start Switches
#########################################
# Sonoff Switches

switch:
  - platform: mqtt
    name: "Rumpus AV"
    state_topic: "stat/sonoff/POWER"
    command_topic: "cmnd/sonoff/POWER"
    availability_topic: "tele/sonoff/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "AC Power"
    state_topic: "stat/sonoff07/POWER"
    command_topic: "cmnd/sonoff07/POWER"
    availability_topic: "tele/sonoff07/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false


#  - platform: mqtt
#    name: "Spare EX Rumpus Occupied"
#    state_topic: "stat/sonoff12/POWER"
#    command_topic: "cmnd/sonoff12/POWER"
#    availability_topic: "tele/sonoff12/LWT"
#    qos: 1
#    payload_on: "ON"
#    payload_off: "OFF"
#    payload_available: "Online"
#    payload_not_available: "Offline"
#    retain: false   

  - platform: mqtt
    name: "Rumpus Screen EX"
    state_topic: "stat/sonoff20/POWER"
    command_topic: "cmnd/sonoff20/POWER"
    availability_topic: "tele/sonoff20/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "Rumpus Manual"
    state_topic: "stat/sonoff21/POWER1"
    command_topic: "cmnd/sonoff21/POWER1"
    availability_topic: "tele/sonoff21/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false 

  - platform: mqtt
    name: "Climate2 Cool"
    state_topic: "stat/sonoff21/POWER2"
    command_topic: "cmnd/sonoff21/POWER2C"
    availability_topic: "tele/sonoff21/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false       


  - platform: mqtt
    name: "Rumpus Phone Charger"
    state_topic: "stat/wemosD2/POWER6"
    command_topic: "cmnd/wemosD2/POWER6"
    availability_topic: "tele/wemosD2/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
  
#  - platform: mqtt
#    name: "Garage Charger"
#    state_topic: "stat/sonoff25/POWER"
#    command_topic: "cmnd/sonoff25/POWER"
#    availability_topic: "tele/sonoff25/LWT"
#    qos: 1
#    payload_on: "ON"
#    payload_off: "OFF"
#    payload_available: "Online"
#    payload_not_available: "Offline"
#    retain: false

    

#########################################
#START Modbus switches
#
#########################################
#START Modbus hub5 switches
#
# 
  - platform: modbus
    scan_interval: 10
    slave: 5
    coils:
      - name: Front Lts Auto Off 1536
        hub: hub5
        slave: 5
        coil: 1536      
      - name:  Laundry Path LTs Auto Off 1545
        hub: hub5
        slave: 5
        coil: 1545
      - name: Daylight Test Normal
        hub: hub5
        slave: 5
        coil: 1548 
      - name: Front Flood LT Auto Normal 1549
        hub: hub5
        slave: 5
        coil: 1549
      - name: Front Flood LT
        hub: hub5
        slave: 5
        coil: 1537
      - name: Laundry Door Downlight
        hub: hub5
        slave: 5
        coil: 1539
      - name:  Front Outside Downlight
        hub: hub5
        slave: 5
        coil: 1552                 
      - name:  Verandah Wall LT
        hub: hub5
        slave: 5
        coil: 1556 
      - name:  Garage Approach Flood LT
        hub: hub5
        slave: 5
        coil: 1540  
      - name:  Driveway Strip LTs
        hub: hub5
        slave: 5
        coil: 1541                
      - name:  Zero Hold Switch
        hub: hub5
        slave: 5
        coil: 1564                                                              
#
#########################################
#END Modbus hub5 switches
#
#
#########################################
#START Modbus hub3 switches
#
      - name: Lower Pond Circulation
        hub: hub3
        slave: 3
        coil: 1569      
      - name:  Lower Pond Discharge
        hub: hub3
        slave: 3
        coil: 1575  
      - name: Topup System
        hub: hub3
        slave: 3
        coil: 1573  
      - name: Topup Manual
        hub: hub3
        slave: 3
        coil: 1536            
      - name: Pressure Pump System
        hub: hub3
        slave: 3
        coil: 1571
      - name: Pressure Pump Force
        hub: hub3
        slave: 3
        coil: 1557 
      - name: Grey Water System
        hub: hub3
        slave: 3
        coil: 1567
      - name: Grey Water Trip Reset
        hub: hub3
        slave: 3
        coil: 1599        
      - name: Storm Water System
        hub: hub3
        slave: 3
        coil: 1565  
      - name: Storm Water Manual
        hub: hub3
        slave: 3
        coil: 1539  
      - name: System E- Stop
        hub: hub3
        slave: 3
        coil: 1558
      - name: Cooling System
        hub: hub3
        slave: 3
        coil: 1582
      - name: Garage Lights Set Mode
        hub: hub3
        slave: 3
        coil: 1590 
      - name: Garage Lights 1
        hub: hub3
        slave: 3
        coil: 1603                      
      - name: Garage Lights 2
        hub: hub3
        slave: 3
        coil: 1604
      - name: Garage Lights 3
        hub: hub3
        slave: 3
        coil: 1605
      - name: Pool Lights
        hub: hub3
        slave: 3
        coil: 1606
      - name: Irrigation AUTO
        hub: hub3
        slave: 3
        coil: 1577
      - name: Irrigation Manual
        hub: hub3
        slave: 3
        coil: 1537
      - name: Irrigation Mode
        hub: hub3
        slave: 3
        coil: 17
      - name: Lower Pond Manual
        hub: hub3
        slave: 3
        coil: 1555  
      - name: Garage Sump AUTO
        hub: hub3
        slave: 3
        coil: 1562
      - name: Irrigation Increment Mode
        hub: hub3
        slave: 3
        coil: 1544  
      - name: Garage Door Open Close
        hub: hub3
        slave: 3
        coil: 1589
      - name: Battery Charger Pump Area Screen
        hub: hub3
        slave: 3
        coil: 1550        
#
#########################################
#END Modbus hub3 switches
#
#
#########################################
#START Modbus hub1 switches
#
      - name: BATCH AUTO OR PAUSE
        hub: hub1
        slave: 1
        coil: 1537    
      - name: Batch Trigger Or Increment
        hub: hub1
        slave: 1
        coil: 1538      
      - name:  WAS Flush Solenoid Trigger
        hub: hub1
        slave: 1
        coil: 1549  
      - name: WAS Flush Solenoid RESET
        hub: hub1
        slave: 1
        coil: 1550
      - name: WAS Flush Choose Solenoid
        hub: hub1
        slave: 1
        coil: 1552 
      - name: Swirl Filter Flush START STOP
        hub: hub1
        slave: 1
        coil: 1541
      - name: Bio Filter Flush START STOP
        hub: hub1
        slave: 1
        coil: 1542        
      - name: Bio Filter to Slow Sand Filter Pump START STOP
        hub: hub1
        slave: 1
        coil: 1553
      - name: WAS Flush Pump START STOP
        hub: hub1
        slave: 1
        coil: 1551        
 
                           

#########################################
#End modbus hub1 switches
#########################################                                                                                                        
#########################################

#  - platform: template
#    switches:
#      climate.rumpus:
#        climate_cool:
#        climate_off:

#########################################        
#End switches
#                              
#
#Start Lights
#########################################

light:
#########################################
#Sonoff Lights
  - platform: mqtt
    name: "Lounge"
    state_topic: "stat/sonoff08/POWER"
    command_topic: "cmnd/sonoff08/POWER"
    availability_topic: "tele/sonoff08/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false 

  - platform: mqtt
    name: "Stairs"
    state_topic: "stat/sonoff4CH01/POWER1"
    command_topic: "cmnd/sonoff4CH01/POWER1"
    availability_topic: "tele/sonoff4CH01/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false    
  
  - platform: mqtt 
    name: "Sink"
    state_topic: "stat/sonoff4CH01/POWER2"
    command_topic: "cmnd/sonoff4CH01/POWER2"
    availability_topic: "tele/sonoff4CH01/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "Path 2"
    state_topic: "stat/sonoff4CH01/POWER3"
    command_topic: "cmnd/sonoff4CH01/POWER3"
    availability_topic: "tele/sonoff4CH01/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "Dining_CH4"
    state_topic: "stat/sonoff4CH01/POWER4"
    command_topic: "cmnd/sonoff4CH01/POWER4"
    availability_topic: "tele/sonoff4CH01/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false    

  - platform: mqtt
    name: "Rumpus Cabinets"
    state_topic: "stat/sonoff4CH02/POWER1"
    command_topic: "cmnd/sonoff4CH02/POWER1"
    availability_topic: "tele/sonoff4CH02/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "Rumpus Desk"
    state_topic: "stat/sonoff4CH02/POWER2"
    command_topic: "cmnd/sonoff4CH02/POWER2"
    availability_topic: "tele/sonoff4CH02/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false    

  - platform: mqtt
    name: "Rumpus Wardrobe"
    state_topic: "stat/sonoff4CH02/POWER3"
    command_topic: "cmnd/sonoff4CH02/POWER3"
    availability_topic: "tele/sonoff4CH02/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false
  
  - platform: mqtt
    name: "Rumpus Fridge"
    state_topic: "stat/sonoff4CH02/POWER4"
    command_topic: "cmnd/sonoff4CH02/POWER4"
    availability_topic: "tele/sonoff4CH02/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false                     

  - platform: mqtt
    name: "Kitchen"
    state_topic: "stat/sonoff04/POWER1"
    command_topic: "cmnd/sonoff04/POWER1"
    availability_topic: "tele/sonoff04/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false 

  - platform: mqtt
    name: "Dining"
    state_topic: "stat/sonoff04/POWER2"
    command_topic: "cmnd/sonoff04/POWER2"
    availability_topic: "tele/sonoff04/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false    

  - platform: mqtt
    name: "Fan Low"
    state_topic: "stat/sonoff05/POWER1"
    command_topic: "cmnd/sonoff05/POWER1"
    availability_topic: "tele/sonoff05/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false    
  
  - platform: mqtt 
    name: "Fan Med"
    state_topic: "stat/sonoff05/POWER2"
    command_topic: "cmnd/sonoff05/POWER2"
    availability_topic: "tele/sonoff05/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "Fan Hi"
    state_topic: "stat/sonoff05/POWER3"
    command_topic: "cmnd/sonoff05/POWER3"
    availability_topic: "tele/sonoff05/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "Fan Off"
    state_topic: "stat/sonoff05/POWER4"
    command_topic: "cmnd/sonoff05/POWER4"
    availability_topic: "tele/sonoff05/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "Patio"
    state_topic: "stat/wemosD2/POWER3"
    command_topic: "cmnd/wemosD2/POWER3"
    availability_topic: "tele/wemosD2/LWT"
    qos: 1
    payload_on: "ON" 
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false 

  - platform: mqtt
    name: "Tank"
    state_topic: "stat/wemosD2/POWER5"
    command_topic: "cmnd/wemosD2/POWER5"
    availability_topic: "tele/wemosD2/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "Side 1"
    state_topic: "stat/wemosD2/POWER1"
    command_topic: "cmnd/wemosD2/POWER1"
    availability_topic: "tele/wemosD2/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false     

  - platform: mqtt
    name: "Master Bedroom LT"
    state_topic: "stat/sonoff18/POWER"
    command_topic: "cmnd/sonoff18/POWER"
    availability_topic: "tele/sonoff18/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false

  - platform: mqtt
    name: "Master Bedroom Reading Light"
    state_topic: "stat/sonoff26/POWER"
    command_topic: "cmnd/sonoff26/POWER"
    availability_topic: "tele/sonoff26/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    retain: false    
        

#Start Fans
#########################################

#fan:
#########################################
#Sonoff Fans


       


#End Fans
#########################################


                   
#
# 
#Start Modbus Hubs
#########################################
modbus:
  - name: hub5
    type: tcp
    host: 192.168.1.175
    port: 5003
    

  - name: hub3
    type: tcp
    host: 192.168.1.173
    port: 5001
    

  - name: hub1
    type: tcp
    host: 192.168.1.174
    port: 5002
    

#########################################
#End Modbus Hubs
#


#Start Binary Sensors
#########################################
#
binary_sensor:
#
#Modbus binary sensors
#
  - platform: modbus
    coils:
#
#START hub5 - slave5 binary sensors
#    
      - name: HW Tariff
        hub: hub5
        slave: 5
        coil: 1538
      - name: Front Occupied
        hub: hub5
        slave: 5
        coil: 1544      
      - name: Back LTs Control
        hub: hub5
        slave: 5
        coil: 1551  
      - name:  Movement Back
        hub: hub5
        slave: 5
        coil: 1553                                 
      - name:  Movement Front
        hub: hub5
        slave: 5
        coil: 1554   
      - name:  Doorbell Flag
        hub: hub5
        slave: 5
        coil: 1555           
      - name:  Laundry Door LT Coil
        hub: hub5
        slave: 5
        coil: 18           
      - name:  Front Right Outside LT Coil
        hub: hub5
        slave: 5
        coil: 19 
      - name:  Front Door Outside LT Coil
        hub: hub5
        slave: 5
        coil: 20
      - name:  Driveway Flood LT Coil
        hub: hub5
        slave: 5
        coil: 21
      - name:  Driveway Strip LT Coil
        hub: hub5
        slave: 5
        coil: 22
      - name:  Front Flood LT Coil
        hub: hub5
        slave: 5
        coil: 23
      - name:  Doorbell Chime Coil
        hub: hub5
        slave: 5
        coil: 7
      - name: DaylightSW DI 1Day 0Night
        hub: hub5
        slave: 5
        coil: 1546                          
      - name: Daylight System 1Day 0Night
        hub: hub5
        slave: 5
        coil: 1547   
      - name: MOVEMENT SENSOR 2 FRONT CENTRAL
        hub: hub5
        slave: 5
        coil: 1557 
      - name: MOVEMENT SENSOR 1 VERANDAH
        hub: hub5
        slave: 5
        coil: 1558
      - name: MOVEMENT SENSOR 3 FRONT DRIVEWAY
        hub: hub5
        slave: 5
        coil: 1559    
      - name: MOVEMENT SENSOR 4 BACK DOOR
        hub: hub5
        slave: 5
        coil: 1560 
      - name: MOVEMENT SENSOR 5 GARAGE APPROACH
        hub: hub5
        slave: 5
        coil: 1561
      - name: MOVEMENT SENSOR 6 GARAGE ROLLER DOOR
        hub: hub5 
        slave: 5
        coil: 1562                
      - name: Laundry Path Occupied
        hub: hub5
        slave: 5
        coil: 1542 
      - name: Back Door Occupied
        hub: hub5
        slave: 5
        coil: 1550
#
#END Modbus hub5 binary sensors
#        
#
#START Modbus hub3 binary sensors
#        
      - name: Lower Pond Circulation Pump Status
        hub: hub3
        slave: 3
        coil: 1570
      - name: Lower Pond Circulation Pump RUN
        hub: hub3
        slave: 3
        coil: 38        
      - name: Lower Pond Discharge Pump Status
        hub: hub3
        slave: 3
        coil: 1576
      - name: Lower Pond Discharge Pump RUN
        hub: hub3
        slave: 3
        coil: 40        
      - name: Pressure Pump System Status
        hub: hub3
        slave: 3
        coil: 1572
      - name: Topup System Status
        hub: hub3
        slave: 3
        coil: 1574
      - name: Grey Water System Status
        hub: hub3
        slave: 3
        coil: 1568
      - name: Grey Water High Level
        hub: hub3
        slave: 3
        coil: 1581
      - name: Grey Water Low Level
        hub: hub3
        slave: 3
        coil: 1561
      - name: Grey Water Pump Run
        hub: hub3
        slave: 3
        coil: 12 
      - name: Grey Water Runcount Trip
        hub: hub3
        slave: 3
        coil: 1600 
      - name: Grey Water Inhibit Status
        hub: hub3
        slave: 3
        coil: 1598                          
      - name: Storm Water System Status
        hub: hub3
        slave: 3
        coil: 1566
      - name: Storm Water Manual Run Status
        hub: hub3
        slave: 3
        coil: 1601
      - name: Storm Water High Level
        hub: hub3
        slave: 3
        coil: 1588
      - name: Storm Water Low Level
        hub: hub3
        slave: 3
        coil: 1587
      - name: Storm Water Pump Run
        hub: hub3
        slave: 3
        coil: 13      
      - name: Cooling System Status
        hub: hub3
        slave: 3
        coil: 1583  
      - name: Cooling Fan Run
        hub: hub3
        slave: 3
        coil: 34  
      - name: Garage Lights Status
        hub: hub3
        slave: 3
        coil: 1591 
      - name: Irrigation Auto Status
        hub: hub3
        slave: 3
        coil: 1578  
      - name: Irrigation Mode Selected
        hub: hub3
        slave: 3
        coil: 1542                       
      - name: Pressure Pump Rain
        hub: hub3
        slave: 3
        coil: 1537
      - name: Pressure Pump Treated
        hub: hub3
        slave: 3
        coil: 18
      - name: Pressure Pump Mains
        hub: hub3
        slave: 3
        coil: 4
      - name: Lower Pond Entry HI LVL
        hub: hub3
        slave: 3
        coil: 1607                       
      - name: Lower Pond Discharge HI LVL
        hub: hub3
        slave: 3
        coil: 1608
      - name: Lower Pond Run LVL
        hub: hub3
        slave: 3
        coil: 1609
      - name: Lower Pond Discharge LO LVL
        hub: hub3
        slave: 3
        coil: 1610 
      - name: Lower Pond Manual Status
        hub: hub3
        slave: 3
        coil: 1554                               
      - name: Garage Sump AUTO Status
        hub: hub3
        slave: 3
        coil: 1563
      - name: Garage Sump RUN
        hub: hub3
        slave: 3
        coil: 41 
      - name: Garage Sump LVL
        hub: hub3
        slave: 3
        coil: 1596
      - name: Garage Sump AUTO Status
        hub: hub3
        slave: 3
        coil: 1563
      - name: Garage Occupied
        hub: hub3
        slave: 3
        coil: 1591       
      - name: Pool Occupied
        hub: hub3
        slave: 3
        coil: 1611
      - name: Irrigation Mode1
        hub: hub3
        slave: 3
        coil: 346 
      - name: Irrigation Mode2
        hub: hub3
        slave: 3
        coil: 347
      - name: Irrigation Mode3
        hub: hub3
        slave: 3
        coil: 388
      - name: Irrigation Mode4
        hub: hub3
        slave: 3
        coil: 389  
      - name: Garage Door Hi Lvl
        hub: hub3
        slave: 3
        coil: 1612 
      - name: Garage Door Lo Lvl
        hub: hub3
        slave: 3
        coil: 1613 
      - name: Battery Charger Pump Area Status
        hub: hub3
        slave: 3
        coil: 1551  
      - name: Battery Charger Pump Area Run
        hub: hub3
        slave: 3
        coil: 11                                 
#
#END Modbus hub3 binary sensors
#        
#
#START Modbus hub1 binary sensors
#
      - name: Batch Auto Pause Status
        hub: hub1
        slave: 1
        coil: 1539
      - name: UV Lamp RUN
        hub: hub1
        slave: 1
        coil: 42
      - name: Batch Pump 1 Run
        hub: hub1
        slave: 1
        coil: 1
      - name: Batch Pump 2 Run
        hub: hub1
        slave: 1
        coil: 3 
      - name: Recirculate Pump 1 Run
        hub: hub1
        slave: 1
        coil: 4
      - name: Recirculate Pump 2 Run
        hub: hub1
        slave: 1
        coil: 0 
      - name: SHADEHOUSE MASTER SOLENOID
        hub: hub1
        slave: 1
        coil: 34 
      - name: WASTE FLUSH ANOXIC SOLENOID
        hub: hub1
        slave: 1
        coil: 35
      - name: WASTE FLUSH CLARIFIER SOLENOID
        hub: hub1
        slave: 1
        coil: 36 
      - name: WAS PUMP RUN
        hub: hub1
        slave: 1
        coil: 2
      - name: Sludge Anoxic LO LVL
        hub: hub1 
        slave: 1
        coil: 1558
      - name: Sludge Anoxic Hi LVL
        hub: hub1
        slave: 1
        coil: 1560
      - name: Clarifier HI LVL
        hub: hub1
        slave: 1
        coil: 1559 
      - name: Clarifier LO LVL
        hub: hub1
        slave: 1
        coil: 1561
      - name: Bio Filter HI LVL
        hub: hub1
        slave: 1
        coil: 1562 
      - name: Bio Filter LO LVL
        hub: hub1
        slave: 1
        coil: 1563
      - name: Final Bio Filter HI LVL
        hub: hub1 
        slave: 1
        coil: 1564 
      - name: Flooded Pipe LO LVL
        hub: hub1 
        slave: 1
        coil: 1565
      - name: Slow Sand Filter HI LVL
        hub: hub1
        slave: 1
        coil: 1566 
      - name: Slow Sand Filter MID LVL
        hub: hub1 
        slave: 1
        coil: 1567   
      - name: Slow Sand Filter LO LVL
        hub: hub1
        slave: 1
        coil: 1568
      - name: Bio Filter To Slow Sand Filter Pump RUN
        hub: hub1
        slave: 1
        coil: 10         
      - name: Reed Bed HI LVL
        hub: hub1 
        slave: 1
        coil: 1569 
      - name: Swirl Filter Flush Pump Run
        hub: hub1
        slave: 1
        coil: 44 
      - name: Bio Filter Flush Pump Run
        hub: hub1 
        slave: 1
        coil: 45 
      - name: Bio Filter to Slow Sand Filter Pump System Status
        hub: hub1 
        slave: 1
        coil: 1554  
      - name: Pool LO Level Status
        hub: hub1 
        slave: 1
        coil: 1556
      - name: Treated Water Interlock Status
        hub: hub1 
        slave: 1
        coil: 1557
      - name: Biofilter LOLVL Interlock Status
        hub: hub1 
        slave: 1
        coil: 1563 
      - name: Slow Sand Filter INTERLOCK Status
        hub: hub1 
        slave: 1
        coil: 1570 
      - name: Safety INTERLOCK Status
        hub: hub1 
        slave: 1
        coil: 1571                               
#
#END Modbus hub1 binary sensors
#                                                                  

#
#START MQTT binary sensors
#
  - platform: mqtt
    name: "Pool Low Level"
    state_topic: "stat/sonoff23/POWER"
#    command_topic: "cmnd/sonoff23/POWER"
    availability_topic: "tele/sonoff23/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"


  - platform: mqtt
    name: "Side Path Movement"
    state_topic: "stat/sonoff09/POWER"
#    command_topic: "cmnd/sonoff09/POWER"
    availability_topic: "tele/sonoff09/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: motion   

  - platform: mqtt
    name: "Side Path Occupied"
    state_topic: "stat/sonoff17/POWER"
#    command_topic: "cmnd/sonoff17/POWER"
    availability_topic: "tele/sonoff17/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: motion     

  - platform: mqtt
    name: "Patio Movement"
    state_topic: "stat/sonoff03/POWER"
#    command_topic: "cmnd/sonoff03/POWER"
    availability_topic: "tele/sonoff03/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: motion     

  - platform: mqtt
    name: "Patio Occupied"
    state_topic: "stat/sonoff13/POWER"
#    command_topic: "cmnd/sonoff13/POWER"
    availability_topic: "tele/sonoff13/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: motion

  - platform: mqtt
    name: "Lounge Occupied"
    state_topic: "stat/sonoff06/POWER"
#    command_topic: "cmnd/sonoff06/POWER"
    availability_topic: "tele/sonoff06/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: motion


 

  - platform: mqtt
    name: "Tank Path Movement"
    state_topic: "cmnd/sonoff14/POWER"
#    command_topic: "cmnd/sonoff14/POWER"
    availability_topic: "tele/sonoff14/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: motion 

  - platform: mqtt
    name: "Tank Path Occupied"
    state_topic: "stat/sonoff15/POWER"
#    command_topic: "cmnd/sonoff15/POWER"
    availability_topic: "tele/sonoff15/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: motion
  
  - platform: mqtt
    name: "Rumpus Movement"
    state_topic: "stat/sonoff10/POWER"
#    command_topic: "cmnd/sonoff10/POWER"
    availability_topic: "tele/sonoff10/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: motion 

  - platform: mqtt
    name: "Desk Movement"
    state_topic: "stat/sonoff11/POWER"
#    command_topic: "cmnd/sonoff11/POWER"
    availability_topic: "tele/sonoff11/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: motion

  - platform: mqtt
    name: "Rumpus Back Door"
    state_topic: "cmnd/wemosD2/POWER2"
#    command_topic: "cmnd/wemosD2/POWER2"
    availability_topic: "tele/wemosD2/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: motion 

  - platform: mqtt
    name: "Patio Wall"
    state_topic: "cmnd/wemosD2/POWER4"
#    command_topic: "cmnd/wemosD2/POWER4"
    availability_topic: "tele/wemosD2/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: motion    
       
  - platform: mqtt
    name: "Rumpus Occupied"
    state_topic: "stat/sonoff16/POWER"
#    command_topic: "cmnd/sonoff16/POWER"
    availability_topic: "tele/sonoff16/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: motion

  - platform: mqtt
    name: "Garage Door"
    state_topic: "stat/sonoff25/POWER"
#    command_topic: "cmnd/sonoff25/POWER"
    availability_topic: "tele/sonoff25/LWT"
    qos: 1
    payload_on: "ON"
    payload_off: "OFF"
    payload_available: "Online"
    payload_not_available: "Offline"
    device_class: door
  

###########################################################
# TEMPLATE binary sensors
###########################################################
# template binary sensor docs: https://www.home-assistant.io/components/binary_sensor.template/

  - platform: template
    sensors:
#############################
# Garage Occupied Status
      garage_detected:
        device_class: motion
        friendly_name: Garage Occupied Status
        value_template: "{{ is_state('binary_sensor.garage_occupied', 'on') }}"
#############################
# Pool Occupied Status        
      pool_detected:
        device_class: motion
        friendly_name: Pool Occupied Status
        value_template: "{{ is_state('binary_sensor.pool_occupied', 'on') }}"
#############################
# Laundry Door Occupied Status        
      back_door_detected:
        device_class: motion
        friendly_name: Laundry Door Occupied Status
        value_template: "{{ is_state('binary_sensor.back_door_occupied', 'on') }}"
#############################
# Front Occupied Status        
      front_detected:
        device_class: motion
        friendly_name: Front Occupied Status
        value_template: "{{ is_state('binary_sensor.front_occupied', 'on') }}"
#############################
# Laundry Path Occupied Status        
      laundry_path_detected:
        device_class: motion
        friendly_name: Laundry Path Occupied Status
        value_template: "{{ is_state('binary_sensor.laundry_path_occupied', 'on') }}"
#############################
# Garage Entry Light       
      garage_entry_light:
        device_class: light
        friendly_name: Garage Entry
        value_template: "{{ is_state('switch.garage_lights_1', 'on') }}"
#############################
# Garage Flouros         
      garage_flouros_light:
        device_class: light
        friendly_name: Garage Flouros
        value_template: "{{ is_state('switch.garage_lights_2', 'on') }}"
#############################
# Driveway Strip LIght        
      garage_flood_light:
        device_class: light
        friendly_name: Driveway Strip LIght
        value_template: "{{ is_state('switch.driveway_strip_lts', 'on') }}"
#############################
# Garage Flood Light        
      driveway_strip_light:
        device_class: light
        friendly_name: Garage Flood Light
        value_template: "{{ is_state('switch.garage_approach_flood_lt', 'on') }}"
#############################
# Front Flood Light        
      front_flood_light:
        device_class: light
        friendly_name: Front Flood Light
        value_template: "{{ is_state('switch.front_flood_lt', 'on') }}"
#############################
# Slow Sand Filter 
# HI LVL       
      ssfilt_hi_lvl:
        entity_picture_template: >-
          {% if is_state('binary_sensor.slow_sand_filter_hi_lvl', 'on') %}
            /local/images/lowLevel.png
          {% else %}
            /local/images/HIHILevel.png
          {% endif %} 
        friendly_name: Slow Sand Filter HI LVL
        value_template: "{{ is_state('binary_sensor.slow_sand_filter_hi_lvl', 'on') }}"
# MID LVL        
      ssfilt_mid_lvl:
        entity_picture_template: >-
          {% if is_state('binary_sensor.slow_sand_filter_mid_lvl', 'on') %}
            /local/images/lowLevel.png
          {% else %}
            /local/images/normalLevel.png
          {% endif %} 
        friendly_name: Slow Sand Filter MID LVL
        value_template: "{{ is_state('binary_sensor.slow_sand_filter_mid_lvl', 'on') }}"
# LO LVL        
      ssfilt_lo_lvl:
        entity_picture_template: >-
          {% if is_state('binary_sensor.slow_sand_filter_lo_lvl', 'on') %}
            /local/images/lowLevel.png
          {% else %}
            /local/images/normalLevel.png
          {% endif %} 
        friendly_name: Slow Sand Filter LO LVL
        value_template: "{{ is_state('binary_sensor.slow_sand_filter_lo_lvl', 'on') }}" 
#############################
# Bio Filter 
# HI LVL
      bio_filt_hi_lvl:
        entity_picture_template: >-
          {% if is_state('binary_sensor.bio_filter_hi_lvl', 'on') %}
            /local/images/lowLevel.png
          {% else %}
            /local/images/HIHILevel.png
          {% endif %} 
        friendly_name: Bio Filter 1 HI LVL
        value_template: "{{ is_state('binary_sensor.bio_filter_hi_lvl', 'on') }}"
# LO LVL        
      bio_filt_lo_lvl:
        entity_picture_template: >-
          {% if is_state('binary_sensor.bio_filter_lo_lvl', 'on') %}
            /local/images/normalLevel.png
          {% else %}
            /local/images/HIHILevel.png
          {% endif %} 
        friendly_name: Slow Sand Filter MID LVL
        value_template: "{{ is_state('binary_sensor.bio_filter_lo_lvl', 'on') }}"
#############################
# Reed Bed HI LVL       
      reedbed_hi_lvl:
        entity_picture_template: >-
          {% if is_state('binary_sensor.reed_bed_hi_lvl', 'on') %}
            /local/images/lowLevel.png
          {% else %}
            /local/images/HIHILevel.png
          {% endif %} 
        friendly_name: Reed Bed HI LVL
        value_template: "{{ is_state('binary_sensor.reed_bed_hi_lvl', 'on') }}"
#############################
# Final Bio Filter HI LVL        
      finalbio_filt_hi_lvl:
        entity_picture_template: >-
          {% if is_state('binary_sensor.final_bio_filter_hi_lvl', 'on') %}
            /local/images/lowLevel.png
          {% else %}
            /local/images/HIHILevel.png
          {% endif %} 
        friendly_name: Final Bio Filter HI LVL
        value_template: "{{ is_state('binary_sensor.final_bio_filter_hi_lvl', 'on') }}" 
#############################
# Flooded Pipe LO LVL        
      floodedpipe_lo_lvl:
        entity_picture_template: >-
          {% if is_state('binary_sensor.flooded_pipe_lo_lvl', 'on') %}
            /local/images/normalLevel.png
          {% else %}
            /local/images/HIHILevel.png
          {% endif %} 
        friendly_name: Final Bio Filter HI LVL
        value_template: "{{ is_state('binary_sensor.flooded_pipe_lo_lvl', 'on') }}"               
#############################
# Bio Filter To Slow Sand Filter Pump RUN
      bio_ss_pump_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.bio_filter_to_slow_sand_filter_pump_run', 'on') %}
            /local/images/submersiblePump_Run.png
          {% else %}
            /local/images/submersiblePump_Stop.png
          {% endif %} 
        friendly_name: Bio Filter To Slow Sand Filter Pump RUN
        value_template: "{{ is_state('binary_sensor.bio_filter_to_slow_sand_filter_pump_run', 'on') }}"
#############################
# Grey Water Pump RUN          
      greywater_pump_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.grey_water_pump_run', 'on') %}
            /local/images/submersiblePump_Run.png
          {% else %}
            /local/images/submersiblePump_Stop.png
          {% endif %} 
        friendly_name: Grey Water Pump RUN
        value_template: "{{ is_state('binary_sensor.grey_water_pump_run', 'on') }}"
#############################
# Storm Water Pump RUN        
      stormwater_pump_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.storm_water_pump_run', 'on') %}
            /local/images/submersiblePump_Run.png
          {% else %}
            /local/images/submersiblePump_Stop.png
          {% endif %} 
        friendly_name: Storm Water Pump RUN
        value_template: "{{ is_state('binary_sensor.storm_water_pump_run', 'on') }}"
#############################
# Garage Sump Pump RUN          
      garagesump_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.garage_sump_run', 'on') %}
            /local/images/submersiblePump_Run.png
          {% else %}
            /local/images/submersiblePump_Stop.png
          {% endif %} 
        friendly_name: Garage Sump Pump RUN
        value_template: "{{ is_state('binary_sensor.garage_sump_run', 'on') }}"
#############################
# Lower Pond Circulation Pump RUN          
      lower_pond_circulationpump_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.lower_pond_circulation_pump_run', 'on') %}
            /local/images/pumpRun.png
          {% else %}
            /local/images/pumpStop.png
          {% endif %} 
        friendly_name: Lower Pond Circulation Pump RUN
        value_template: "{{ is_state('binary_sensor.lower_pond_circulation_pump_run', 'on') }}"
#############################
# Lower Pond Discharge Pump RUN         
      lower_pond_dischargepump_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.lower_pond_discharge_pump_run', 'on') %}
            /local/images/pumpRun.png
          {% else %}
            /local/images/pumpStop.png
          {% endif %} 
        friendly_name: Lower Pond Discharge Pump RUN
        value_template: "{{ is_state('binary_sensor.lower_pond_discharge_pump_run', 'on') }}"
#############################
# Rain Pressure Pump RUN          
      rain_pressurepump_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.pressure_pump_mains', 'on') %}
            /local/images/pumpRun.png
          {% else %}
            /local/images/pumpStop.png
          {% endif %} 
        friendly_name: Rain Pressure Pump RUN
        value_template: "{{ is_state('binary_sensor.pressure_pump_mains', 'on') }}"
#############################
# Treated Pressure Pump RUN           
      treated_pressurepump_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.pressure_pump_treated', 'on') %}
            /local/images/pumpRun.png
          {% else %}
            /local/images/pumpStop.png
          {% endif %} 
        friendly_name: Treated Pressure Pump RUN
        value_template: "{{ is_state('binary_sensor.pressure_pump_treated', 'on') }}"
#############################
# Mains Solenoid RUN           
      mains_solenoid_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.pressure_pump_rain', 'on') %}
            /local/images/solenoidON.png
          {% else %}
            /local/images/solenoidOFF.png
          {% endif %} 
        friendly_name: Mains Solenoid RUN
        value_template: "{{ is_state('binary_sensor.pressure_pump_rain', 'on') }}"
#############################
# Batch Pump 1 RUN        
      batch_pump_one_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.batch_pump_1_run', 'on') %}
            /local/images/submersiblePump_Run.png
          {% else %}
            /local/images/submersiblePump_Stop.png
          {% endif %} 
        friendly_name: Batch Pump 1 RUN
        value_template: "{{ is_state('binary_sensor.batch_pump_1_run', 'on') }}"
#############################
# Batch Pump 2 RUN           
      batch_pump_two_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.batch_pump_2_run', 'on') %}
            /local/images/submersiblePump_Run.png
          {% else %}
            /local/images/submersiblePump_Stop.png
          {% endif %} 
        friendly_name: Batch Pump 2 RUN
        value_template: "{{ is_state('binary_sensor.batch_pump_2_run', 'on') }}"
#############################
# Recirculation Pump 1 RUN         
      recirc_pump_one_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.recirculate_pump_1_run', 'on') %}
            /local/images/submersiblePump_Run.png
          {% else %}
            /local/images/submersiblePump_Stop.png
          {% endif %} 
        friendly_name: Recirculation Pump 1 RUN
        value_template: "{{ is_state('binary_sensor.recirculate_pump_1_run', 'on') }}"
#############################
# Recirculation Pump 2 RUN           
      recirc_pump_two_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.recirculate_pump_2_run', 'on') %}
            /local/images/submersiblePump_Run.png
          {% else %}
            /local/images/submersiblePump_Stop.png
          {% endif %} 
        friendly_name: Recirculation Pump 2 RUN
        value_template: "{{ is_state('binary_sensor.recirculate_pump_2_run', 'on') }}"
#############################
# Activated Sludge System Levels 
# Anoxic HI LVL       
      sludgeanoxic_hi_lvl:
        entity_picture_template: >-
          {% if is_state('binary_sensor.sludge_anoxic_hi_lvl', 'on') %}
            /local/images/lowLevel.png
          {% else %}
            /local/images/HIHILevel.png
          {% endif %} 
        friendly_name: Sludge Anoxic HI LVL
        value_template: "{{ is_state('binary_sensor.sludge_anoxic_hi_lvl', 'on') }}"
#############################
# Anoxic LO LVL        
      sludgeanoxic_lo_lvl:
        entity_picture_template: >-
          {% if is_state('binary_sensor.sludge_anoxic_lo_lvl', 'on') %}
            /local/images/lowLevel.png
          {% else %}
            /local/images/normalLevel.png
          {% endif %} 
        friendly_name: Sludge Anoxic LO LVL
        value_template: "{{ is_state('binary_sensor.sludge_anoxic_lo_lvl', 'on') }}"
#############################
# Clarifier HI LVL NOTE: ORIGINAL SENSORS NAMES TRANSPOSED        
      clarif_hi_lvl:
        entity_picture_template: >-
          {% if is_state('binary_sensor.clarifier_lo_lvl', 'on') %}
            /local/images/normalLevel.png
          {% else %}
            /local/images/lowLevel.png
          {% endif %} 
        friendly_name: Clarifier HI LVL
        value_template: "{{ is_state('binary_sensor.clarifier_lo_lvl', 'on') }}"        
#############################
# Clarifier LO LVL NOTE: ORIGINAL SENSORS NAMES TRANSPOSED       
      clarif_lo_lvl:
        entity_picture_template: >-
          {% if is_state('binary_sensor.clarifier_hi_lvl', 'on') %}
            /local/images/normalLevel.png
          {% else %}
            /local/images/HIHILevel.png
          {% endif %} 
        friendly_name: Clarifier LO LV
        value_template: "{{ is_state('binary_sensor.clarifier_hi_lvl', 'on') }}" 

#############################
# WAS Pump RUN         
      was_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.was_pump_run', 'on') %}
            /local/images/submersiblePump_Run.png
          {% else %}
            /local/images/submersiblePump_Stop.png
          {% endif %} 
        friendly_name: WAS Pump RUN
        value_template: "{{ is_state('binary_sensor.was_pump_run', 'on') }}"
#############################
# Bio Filter To Slow Sand Filter Pump RUN            
      bio_to_slow_sand_filt_pump_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.bio_filter_to_slow_sand_filter_pump_run', 'on') %}
            /local/images/submersiblePump_Run.png
          {% else %}
            /local/images/submersiblePump_Stop.png
          {% endif %} 
        friendly_name: Bio Filter To Slow Sand Filter Pump RUN
        value_template: "{{ is_state('binary_sensor.bio_filter_to_slow_sand_filter_pump_run', 'on') }}" 
#############################
# UV ON            
      uvlamp_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.uv_lamp_run', 'on') %}
            /local/images/uv_ON.png
          {% else %}
            /local/images/uv_OFF.png
          {% endif %} 
        friendly_name: Bio Filter To Slow Sand Filter Pump RUN
        value_template: "{{ is_state('binary_sensor.uv_lamp_run', 'on') }}"
#############################
# Bio Flush Pump RUN         
      biofilter_flush_pump_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.bio_filter_flush_pump_run', 'on') %}
            /local/images/submersiblePump_Run.png
          {% else %}
            /local/images/submersiblePump_Stop.png
          {% endif %} 
        friendly_name: WAS Pump RUN
        value_template: "{{ is_state('binary_sensor.bio_filter_flush_pump_run', 'on') }}"
#############################
# Swirl Flush RUN            
      swirlfilter_flush_pump_run:
        entity_picture_template: >-
          {% if is_state('binary_sensor.swirl_filter_flush_pump_run', 'on') %}
            /local/images/submersiblePump_Run.png
          {% else %}
            /local/images/submersiblePump_Stop.png
          {% endif %} 
        friendly_name: Bio Filter To Slow Sand Filter Pump RUN
        value_template: "{{ is_state('binary_sensor.swirl_filter_flush_pump_run', 'on') }}" 
#############################                                                                                                  

#
#END MQTT binary sensors
#  

#
#Panel Iframe
#    

panel_iframe:
  mdiindex:
    title: MDI Icon Index
    icon: mdi:vector-square
    url: https://cdn.rawgit.com/james-fry/home-assistant-mdi/efd95d7a/home-assistant-mdi.html
  nr_dash:
    title: "NR-Dash" 
    url: "http://192.168.1.55:1880/ui/#/0"
    icon: mdi:television-guide  

  ip_cam:
    title: "TechView"
    url: "http://192.168.1.172:8023/login"
    icon: mdi:webcam



#
#END Panel Iframe
# 

#
#Start Climate Devices
#########################################

#climate:
#   - platform: mitsubishi_mqtt
#     name: "Rumpus AC"
#     command_topic: "heatpump/set"
#     temperature_state_topic: "heatpump/status"
#     state_topic: "heatpump"


#  - platform: generic_thermostat
#    name: Rumpus
#    heater: switch.climate1_cool
#    target_sensor: sensor.rumpus_temperature
#    min_temp: 19
#    max_temp: 26
#    ac_mode: true
#    #target_temp: 24 best left blank
#    cold_tolerance: 1
#    hot_tolerance: 1
#    min_cycle_duration:
#      seconds: 180
#    keep_alive:
#      minutes: 3
#    initial_operation_mode: "off"
#    away_temp: 24



#  - platform: generic_thermostat
#    name: Lounge
#    heater: switch.climate2_cool
#    target_sensor: sensor.lounge
#    min_temp: 19
#    max_temp: 26
#    ac_mode: true
#    #target_temp: 24 best left blank
#    cold_tolerance: 1
#    hot_tolerance: 1
#    min_cycle_duration:
#      seconds: 180
#    keep_alive:
#      minutes: 3
#    initial_operation_mode: "off"
#    away_temp: 24    
#
#END Climate Device


#
#Start Input Boolean
#########################################
input_boolean:
  light_auto:
    name: Light Auto
    initial: off
    icon: mdi:lightbulb-on-outline

  light_manual:
    name: Light Manual
    initial: off
    icon: mdi:lightbulb-off-outline    
#########################################

#Start Input Number
#########################################
input_number:
#########################################
  slider1:
    name: Irrigation Start Time
    initial: 9
    min: 4
    max: 22
    step: 1
#########################################

#########################################
  slider2:
    name: Sludge Pump Restart Delay
    initial: 30
    min: 20
    max: 60
    step: 1
#########################################

#########################################
  slider3:
    name: Irrigation Shadehouse Setpoint
    initial: 20
    min: 1
    max: 25
    step: 1
#########################################

#########################################
  slider4:
    name: Irrigation Pool Setpoint
    initial: 8
    min: 1
    max: 25
    step: 1
#########################################

#########################################
  slider5:
    name: Charger Start Time
    initial: 6
    min: 1
    max: 23
    step: 1
#########################################

#########################################
  slider6:
    name: Charger Stop Time
    initial: 7
    min: 1
    max: 23
    step: 1
#########################################

#########################################
  slider7:
    name: Grey Water Run Setpoint
    initial: 15
    min: 0
    max: 25
    step: 1
#########################################

#########################################
# Utility Meters
#########################################
utility_meter:
  energy:
    source: sensor.power_cumulative_total_3154
    cycle: weekly


#########################################
# Start Camera config
#########################################

camera:
  - platform: generic
    name: esp32Cam2
    still_image_url: http://192.168.1.189/capture?

  - platform: generic
    name: techview
    still_image_url: http://192.168.1.172:8023/snapshot?
    username: admin
    password: sw4240sw

 
#########################################
# END Camera config
#########################################

stream:

# Text to speech
tts:
  - platform: google_translate
    service_name: google_say

group: !include groups.yaml
automation: !include automations.yaml
script: !include scripts.yaml
